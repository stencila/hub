{% load i18n humanize stencila %}

<div class="columns is-relative my-0 py-0 {% if is_list_item %}job-list--item{% endif %}">
  <div class="column is-2">
    <div class="is-inline-block-mobile">
      <div class="tag has-text-weight-bold mb-1">
        {{ job.method|title }}
      </div>
    </div>
    {% include "./_job_status_tag.html" %}
  </div>
  <div class="column">

    <div class="job-list--meta mb-2">
      {% if show_sub_jobs == None %}
      <span class="job-list__creator">
        <span class="icon is-small is-vcentered pr-1">
          <img src="{{ job.creator.personal_account.image.small }}"
               role="presentation"></img>
        </span>
        <span class="is-vcentered">
          {{ job.creator.username|default:"Anon" }}
        </span>
      </span>

      <span alt="{{ job.created }}">
        <span class="icon is-vcentered">
          <i class="ri-calendar-line"></i>
        </span>
        <span class="is-vcentered">
          {{ job.created|naturaltime }}
        </span>
      </span>
      {% endif %}

      {% if job.runtime_formatted %}
      <span>
        <span class="icon is-vcentered">
          <i class="ri-timer-line"></i>
        </span>
        <span class="is-vcentered">
          {{ job.runtime_formatted }}
        </span>
      </span>
      {% endif %}

      <span alt="Job ID">
        <span class="icon is-vcentered">
          <i class="ri-hashtag"></i>
        </span>
        <span class="is-vcentered">
          {{ job.id }}
        </span>
      </span>
    </div>

    <div>
      <span class="has-text-weight-bold">
        {{ job.summary_string }}
      </span>
    </div>
  </div>

  <div class="column is-2 job-list-item-buttons">
    {% if job.creator ==  request.user or project.role in "MANAGER,OWNER" %}
    {% if job.is_active %}
      <a hx-patch="{% url 'api-projects-jobs-cancel' job.project.id job.id %}"
         hx-swap="none"
         href="#"
         class="button is-danger is-outlined is-fullwidth is-small has-text-weight-bold job-list-item-buttons--cancel">
        <span class="icon"><i class="ri-stop-line"></i></span>
        <span>{% trans "Cancel" %}</span>
      </a>
    {% endif %}
    {% endif %}
    
    {% if is_list_item %}
      <a href="{% url 'ui-projects-jobs-retrieve' job.project.account.name job.project.name job.id %}"
         class="button is-outlined is-fullwidth is-small has-text-weight-bold primary-link">
        <span class="icon"><i class="ri-eye-line"></i></span>
        <span>{% trans "Details" %}</span>
      </a>
    {% endif %}
  </div>

</div>

{% if show_sub_jobs == True %}
{% with jobs=job.get_children %}
{% if jobs %}
<div class="job-list__sub-jobs">
  {% include "./_job_list.html" with show_sub_jobs=True %}
</div>
{% endif %}
{% endwith %}
{% endif %}
